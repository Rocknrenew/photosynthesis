<!DOCTYPE html>
<html lang="en">
<head>

<meta charset="UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1">
<meta name="description" content="Babbles text generated from your images.">
<meta name="author" content="Ross Goodwin">
<title>word.camera</title>

<!--

word.camera image-to-text translator
Copyright  (C) 2015  Ross Goodwin
 
This program is free software: you can redistribute it and/or modify
it under the terms of the GNU General Public License as published by
the Free Software Foundation, either version 3 of the License, or
(at your option) any later version.
 
This program is distributed in the hope that it will be useful,
but WITHOUT ANY WARRANTY; without even the implied warranty of
MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the
GNU General Public License for more details.
 
You should have received a copy of the GNU General Public License
along with this program.  If not, see <http://www.gnu.org/licenses/>.
 
You can contact Ross Goodwin at ross.goodwin@gmail.com or address
physical correspondence to:
 
Ross Goodwin c/o ITP
721 Broadway
4th Floor
New York, NY 10003

-->

<link rel="apple-touch-icon" sizes="57x57" href="/static/fav/apple-touch-icon-57x57.png">
<link rel="apple-touch-icon" sizes="60x60" href="/static/fav/apple-touch-icon-60x60.png">
<link rel="apple-touch-icon" sizes="72x72" href="/static/fav/apple-touch-icon-72x72.png">
<link rel="apple-touch-icon" sizes="76x76" href="/static/fav/apple-touch-icon-76x76.png">
<link rel="apple-touch-icon" sizes="114x114" href="/static/fav/apple-touch-icon-114x114.png">
<link rel="apple-touch-icon" sizes="120x120" href="/static/fav/apple-touch-icon-120x120.png">
<link rel="apple-touch-icon" sizes="144x144" href="/static/fav/apple-touch-icon-144x144.png">
<link rel="apple-touch-icon" sizes="152x152" href="/static/fav/apple-touch-icon-152x152.png">
<link rel="apple-touch-icon" sizes="180x180" href="/static/fav/apple-touch-icon-180x180.png">
<link rel="icon" type="image/png" href="/static/fav/favicon-32x32.png" sizes="32x32">
<link rel="icon" type="image/png" href="/static/fav/favicon-194x194.png" sizes="194x194">
<link rel="icon" type="image/png" href="/static/fav/favicon-96x96.png" sizes="96x96">
<link rel="icon" type="image/png" href="/static/fav/android-chrome-192x192.png" sizes="192x192">
<link rel="icon" type="image/png" href="/static/fav/favicon-16x16.png" sizes="16x16">
<link rel="manifest" href="/static/fav/manifest.json">
<link rel="shortcut icon" href="/static/fav/favicon.ico">
<meta name="msapplication-TileColor" content="#ffffff">
<meta name="msapplication-TileImage" content="/static/fav/mstile-144x144.png">
<meta name="msapplication-config" content="/static/fav/browserconfig.xml">
<meta name="theme-color" content="#ffffff">

<link href='http://fonts.googleapis.com/css?family=Cousine:400,700,400italic,700italic' rel='stylesheet' type='text/css'>

	<!-- Bootstrap core CSS -->
    <!-- Latest compiled and minified CSS -->
<!-- Latest compiled and minified CSS -->
<link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap.min.css">

<!-- Optional theme -->
<!-- <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/css/bootstrap-theme.min.css"> -->

<!-- Latest compiled and minified JavaScript -->
<script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.3.4/js/bootstrap.min.js"></script>

    <!-- Custom styles for this template -->
    <link href="/static/css/cover.css" rel="stylesheet">

    <!-- HTML5 shim and Respond.js for IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
      <script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
    <![endif]-->

<style>

#p5canvas {
  z-index: 100;
  width:100%;
  height:100%;
  top:0;
  left:0;
  display:none;
  position:fixed;
  background-color: #F2F1EF;
  overflow:auto;
}

#selfie {
  z-index: 100;
  width:100%;
  height:100%;
  top:0;
  left:0;
  display:block;
  position:fixed;
  background-color: #F2F1EF;
  overflow:auto;
}

#loadvid {
  width: 900px;
  height: 600px;
  margin: auto;
}

.submit {
	text-align: center;
}

.round {
	border-radius: 20%;
}

label.btn input[type="file"] {
    position: fixed;
    top: -1000px;
}

.aj {
  border: 2px solid #FFFFFF;
}

.aj:hover {
  border: 2px solid #FFFFFF;
  background-color: #E08283;
}

.btn-gray-hover:hover {
  background-color: #D2D7D3;
  border-color: #D2D7D3;
}

.custom-font {
	font-family: "Cousine", monospace;
	/*text-align: left;*/
}

.align-center {
	/*text-align: right;*/
	padding-bottom: 25px;
}

.left-align {
  /*text-align: left;*/
}

.green-text {
	color: #87D37C;
}

.top-space {
	padding-top: 10px;
}

.more-top-space {
  padding-top: 40px;
}

.little-top-space {
  margin-top: 5px;
}

.top-vacuum {
  margin-top: -50px;
}

.bottom-vacuum {
  margin-bottom: -5px;
}

.left-space {
  padding-left: 90px;
}

a.underline-links {
	text-decoration: underline;
}

.shadow {
  background-color: rgba(51, 51, 51, 0.8);
}

.xtra-small {
  font-size: 14px;
  margin-top: -15px;
}

.red-text {
  color: #EF4836;
}

loadingdiv {
  display: none;
}

#video {
  border: 1px solid black;
  box-shadow: 2px 2px 3px black;
  width:320px;
  height:240px;
}

/*#photo {
  border: 1px solid black;
  box-shadow: 2px 2px 3px black;
  width:320px;
  height:240px;
}*/

#canvas {
  display:none;
}

.camera {
  width: 340px;
  display:block;
  margin: 0px auto 0px auto;
}

.output {
  width: 340px;
  display:block;
}

#startbutton {
  display:block;
  position:relative;
  margin-left:auto;
  margin-right:auto;
  bottom:15px;
/*background-color: rgba(0, 150, 0, 0.5);
  border: 1px solid rgba(255, 255, 255, 0.7);
  box-shadow: 0px 0px 1px 2px rgba(0, 0, 0, 0.2);
  font-size: 14px;
  font-family: "Lucida Grande", "Arial", sans-serif;
  color: rgba(255, 255, 255, 1.0);*/
}

.contentarea {
  font-size: 16px;
  font-family: "Lucida Grande", "Arial", sans-serif;
  width: 760px;
}

</style>

<script>
  (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-50113889-10', 'auto');
  ga('send', 'pageview');

</script>

</head>

<body>

<div id="p5canvas"></div>
<!-- <div class="output">
  <img id="photo" alt="The screen capture will appear in this box.">
</div> -->

<div class="site-wrapper custom-font">

      <div class="site-wrapper-inner">

        <div class="cover-container shadow">

          <div class="masthead clearfix">
            <div class="inner">
              <!-- <h3 class="masthead-brand">VIDEO PIZZA</h3> -->
              <!-- <nav>
                <ul class="nav masthead-nav">
                  <li class="active"><a href="#">Home</a></li>
                  <li><a href="#">About</a></li>
                </ul>
              </nav> -->
            </div>
          </div>

          <div class="inner cover">
            <!-- <h4 class="cover-heading align-center">word.camera</h4> -->
            <!-- <p class="lead"> -->
<!--             <form method="post" action="sum" id="video-url-submit">
              <div class="urlbox">
                <input name="videourl" type="text" size=50 maxlength=200 placeholder="Type Video URL Here" tabindex="1"/>
              </div>
              <div class="submit">
                <button class="btn btn-lg btn-danger" type="submit" tabindex="1" onclick="divShow()">Make GIF Summary</button>
              </div>
            </form> -->
            <div class="submit">
	            <!-- <form id="form" action="img" method="post" enctype="multipart/form-data"> -->
                <div class="camera">
                    <video id="video">Video stream not available.</video>
                    <button id="startbutton" class="btn btn-danger round aj">
                      <img src="/static/assets/capture_icon.png">
                    </button>
                </div>
                <canvas id="canvas"></canvas>
	            	<!-- <label class="btn btn-lg btn-danger round aj">
      						<input type="file" capture="camera" accept="image/*" id="file" name="file">
      						<img src="/static/assets/capture_icon.png">
      					</label> -->
      				<!-- </form> -->
      			</div>
            <!-- </p> -->

            <p class="lead top-space left-align">
            Allow camera access, then click<br />
            the <span class="red-text">red button</span> to make a lexograph.            </p>

            <p class="top-space left-align bottom-vacuum">
             Or upload an image from your computer:
           </p>

          <form id="form top-vacuum" action="img" method="post" enctype="multipart/form-data">

                <input class="top-space left-space" style="margin-left:auto;margin-right:auto;" type="file" capture="camera" accept="image/*" id="file" name="file">
                <input type="hidden" name="IfYouScriptThisForm" value="GnomesWillEatYourLungs">
                <button class="btn btn-default btn-xs btn-gray-hover little-top-space" name="submit" type="submit" onclick="gogogo()">upload</button>
          </form>

            <p class="xtra-small more-top-space"><em>
            The generator may take up to 5 minutes to translate your image into text.
            </em></p>
            <p class="top-space left-align"><a href="http://word.camera">word.camera</a> by <a href="http://rossgoodwin.com">Ross Goodwin</a>, 2015</p>
          </div>

<!--           <div class="mastfoot">
            <div class="inner">
              <p>Cover template for <a href="http://getbootstrap.com">Bootstrap</a>, by <a href="https://twitter.com/mdo">@mdo</a>.</p>
            </div>
          </div> -->

        </div>

      </div>

    </div>

<script>

var streamObj = null;

// var submitFromDesktopForm = document.getElementById("file");

(function() {
  // The width and height of the captured photo. We will set the
  // width to the value defined here, but the height will be
  // calculated based on the aspect ratio of the input stream.

  var width = 320;    // We will scale the photo width to this
  var height = 0;     // This will be computed based on the input stream

  // |streaming| indicates whether or not we're currently streaming
  // video from the camera. Obviously, we start at false.

  var streaming = false;

  // The various HTML elements we need to configure or control. These
  // will be set by the startup() function.

  var video = null;
  var canvas = null;
  // var photo = null;
  var startbutton = null;
  // var streamObj = null;

  function startup() {
    video = document.getElementById('video');
    canvas = document.getElementById('canvas');
    // photo = document.getElementById('photo');
    startbutton = document.getElementById('startbutton');

    navigator.getMedia = ( navigator.getUserMedia ||
                           navigator.webkitGetUserMedia ||
                           navigator.mozGetUserMedia ||
                           navigator.msGetUserMedia);

    navigator.getMedia(
      {
        video: true,
        audio: false
      },
      function(stream) {
        if (navigator.mozGetUserMedia) {
          video.mozSrcObject = stream;
        } else {
          var vendorURL = window.URL || window.webkitURL;
          video.src = vendorURL.createObjectURL(stream);
        }
        video.play();
        streamObj = stream;
      },
      function(err) {
        console.log("An error occured! " + err);
      }
    );

    video.addEventListener('canplay', function(ev){
      if (!streaming) {
        height = video.videoHeight / (video.videoWidth/width);
      
        // Firefox currently has a bug where the height can't be read from
        // the video, so we will make assumptions if this happens.
      
        if (isNaN(height)) {
          height = width / (4/3);
        }
      
        video.setAttribute('width', width);
        video.setAttribute('height', height);
        canvas.setAttribute('width', width);
        canvas.setAttribute('height', height);
        streaming = true;
      }
    }, false);

    startbutton.addEventListener('click', function(ev){
      takepicture();
      ev.preventDefault();
    }, false);
    
    clearphoto();
  }

  // Fill the photo with an indication that none has been
  // captured.

  function clearphoto() {
    var context = canvas.getContext('2d');
    context.fillStyle = "#AAA";
    context.fillRect(0, 0, canvas.width, canvas.height);

    var data = canvas.toDataURL('image/png');
    // photo.setAttribute('src', data);
  }
  
  // Capture a photo by fetching the current contents of the video
  // and drawing it into a canvas, then converting that to a PNG
  // format data URL. By drawing it on an offscreen canvas and then
  // drawing that to the screen, we can change its size and/or apply
  // other changes before drawing it.

  function takepicture() {
    var context = canvas.getContext('2d');
    if (width && height) {
      canvas.width = width;
      canvas.height = height;
      context.drawImage(video, 0, 0, width, height);
    
      var data = canvas.toDataURL('image/jpeg', 1.0);
      console.log(data);
      var encodedImg = data.substring(data.indexOf(',') + 1, data.length);
      // var decodedImg = base64toBlob(encodedImg, "image/jpeg");
      // photo.setAttribute('src', data);
      divShow();
      loop();
      streamObj.stop();
      post('img', { base64img : encodedImg });
    } else {
      clearphoto();
    }
  }

  // Set up our event listener to run the startup process
  // once loading is complete.
  window.addEventListener('load', startup, false);

})();

function gogogo() {
  if (!!streamObj) {
    streamObj.stop();
  }
    divShow();
    loop();
};

function post(path, params, method) {
    method = method || "post"; // Set method to post by default if not specified.

    // The rest of this code assumes you are not using a library.
    // It can be made less wordy if you use one.
    var form = document.createElement("form");
    form.setAttribute("method", method);
    form.setAttribute("action", path);

    for(var key in params) {
        if(params.hasOwnProperty(key)) {
            var hiddenField = document.createElement("input");
            hiddenField.setAttribute("type", "hidden");
            hiddenField.setAttribute("name", key);
            hiddenField.setAttribute("value", params[key]);

            form.appendChild(hiddenField);
         }
    }

    document.body.appendChild(form);
    form.submit();
}

function divShow() {
  document.getElementById('p5canvas').style.display = "block";
}

function divHide() {
  document.getElementById('p5canvas').style.display = "none";
}

</script>

<script src="https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js"></script>

<script src="/static/js/libs/p5.min.js" type="text/javascript"></script>
<script src="/static/js/libs/p5.dom.js" type="text/javascript"></script>

<script>

// function loadscreen() {
//   if (document.getElementById("ti1").value != "") {
//     loop();
//   }
// }

var i = 0;
var statusList = ['init convo net', 'analyzing image', 'generating tags', 'init conceptnet db', 'making coffee', 'lexical assoc queries', 'assembling sentences', 'drinking coffee', 'assembling sentences', 'smoking cigarettes', 'assembling sentences', 'drinking coffee', 'consulting templates', 'drinking whiskey', 'assembling sentences', 'drinking whiskey', 'assembling sentences', 'mutating PPNs', 'mumbling unintelligibly', 'assembling sentences', 'rationalizing life choices', 'assembling sentences', 'smoking cigarettes', 'consulting template engine', 'drinking whiskey', 'reticulating splines', 'borkulating', 'reticulating splines', 'reborkulating'];
var onScreen = [];
var rhb = [];
var imgCount = 0;

function preload() {
  for (n=0;n<14;n++) {
    rhb[n] = loadImage("/static/assets/rhb/"+n+".png");
  }
}

function setup() {
  var myCanvas = createCanvas(500, 1500);
  myCanvas.parent('p5canvas');
  noLoop();
}

function draw() {
  background(242, 241, 239);

  if (i >= statusList.length) {
    i = 18;
  }
  var currentStatus = statusList[i];

  fill(242, 38, 19);
  noStroke();
  textSize(18);
  textFont("Monospace");
  
  image(rhb[imgCount], 0, 0);

  if (frameCount > 0) {
    text(currentStatus, 15, 270);
  }  

  imgCount++;
  if (imgCount > 13) {
  	imgCount = 0;
  }

  var k = 0;
  for (j=onScreen.length - 1; j>=0; j--) {
    text(onScreen[j], 15, 290+20*k);
    k++;
  }
  
  var x = Math.random() >= 0.3;
  if (frameCount > 0 && frameCount % 60 === 0 && x) {
    i++;
    append(onScreen, currentStatus);
  }
}

</script>

</body>
</html>